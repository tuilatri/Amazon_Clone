erDiagram
    %% User Domain
    site_user {
        int user_id PK
        string user_name
        int age
        string gender
        string email_address UK
        string phone_number UK
        string city
        string password
        int role
        datetime created_at
        datetime updated_at
        datetime last_login_at
        string status
    }
    
    address {
        int address_id PK
        string unit_number
        string street_number
        string address_line1
        string address_line2
        string region
        string postal_code
    }
    
    user_address {
        int user_id PK_FK
        int address_id PK_FK
        boolean is_default
    }
    
    user_payment_method {
        int payment_method_id PK
        int user_id FK
        int payment_type_id FK
        string provider
        string account_number
        date expiry_date
        boolean is_default
    }
    
    user_review {
        int user_review_id PK
        int user_id FK
        int ordered_product_id FK
        decimal rating_value
        text comment
    }
    
    %% Product Domain
    product {
        string product_id PK
        string product_name
        string main_category
        string main_category_encoded
        string sub_category
        string sub_category_encoded
        string product_image
        string product_link
        float average_rating
        int no_of_ratings
        decimal discount_price_usd
        decimal actual_price_usd
        int category_id FK
    }
    
    product_category {
        int category_id PK
        int parent_category_id FK
        string category_name
    }
    
    product_item {
        string product_item_id PK
        string product_id FK
        string SKU
        decimal price
        boolean is_in_stock
        string product_image
    }
    
    product_rating {
        int rating_id PK
        int user_id FK
        string product_id FK
        float rating
    }
    
    %% Variation Domain
    variation {
        int variation_id PK
        int category_id FK
        string name
        string size
        string color
    }
    
    variation_option {
        int variation_option_id PK
        int variation_id FK
        string value
    }
    
    product_configuration {
        string product_item_id PK_FK
        int variation_option_id PK_FK
    }
    
    %% Promotion Domain
    promotion {
        int promotion_id PK
        string name
        text description
        decimal discount_rate
        date start_date
        date end_date
    }
    
    promotion_category {
        int category_id PK_FK
        int promotion_id PK_FK
    }
    
    %% Shopping Cart Domain
    shopping_cart {
        int shopping_cart_id PK
        int user_id FK
    }
    
    shopping_cart_item {
        int shopping_cart_id PK_FK
        string product_id PK_FK
        int quantity
        decimal price
    }
    
    %% Order Domain
    order_status {
        int order_status_id PK
        string status
    }
    
    shop_order {
        int order_id PK
        int user_id FK
        date order_date
        decimal order_total
        int payment_method_id FK
        int shipping_method_id FK
        int order_status_id FK
        datetime created_at
        datetime completed_at
    }
    
    order_line {
        int ordered_product_id PK
        int order_id FK
        string product_id FK
        int qty
        decimal price
    }
    
    %% Payment and Shipping Domain
    payment_type {
        int payment_type_id PK
        string payment_name
    }
    
    shipping_method {
        int shipping_method_id PK
        string type
        decimal price
    }
    
    %% Interest Domain
    interesting_category {
        int interesting_category_id PK
        int category_id FK
        int user_id FK
    }

    %% Relationships - User Domain
    site_user ||--o{ user_address : "has"
    address ||--o{ user_address : "used_by"
    site_user ||--o{ user_payment_method : "owns"
    site_user ||--o{ user_review : "writes"
    site_user ||--o{ product_rating : "rates"
    site_user ||--o{ shopping_cart : "has"
    site_user ||--o{ shop_order : "places"
    site_user ||--o{ interesting_category : "interested_in"
    
    %% Relationships - Product Domain
    product_category ||--o{ product : "contains"
    product_category ||--o| product_category : "parent_of"
    product ||--o{ product_item : "has"
    product ||--o{ product_rating : "receives"
    product ||--o{ shopping_cart_item : "in"
    
    %% Relationships - Variation Domain
    product_category ||--o{ variation : "defines"
    variation ||--o{ variation_option : "has"
    product_item ||--o{ product_configuration : "configured_by"
    variation_option ||--o{ product_configuration : "applied_to"
    
    %% Relationships - Promotion Domain
    promotion ||--o{ promotion_category : "applies_to"
    product_category ||--o{ promotion_category : "has"
    product_category ||--o{ interesting_category : "tracked_by"
    
    %% Relationships - Shopping Cart Domain
    shopping_cart ||--o{ shopping_cart_item : "contains"
    
    %% Relationships - Order Domain
    shop_order ||--o{ order_line : "contains"
    order_line ||--o{ user_review : "reviewed_by"
    order_line }o--|| product : "for"
    order_status ||--o{ shop_order : "status_of"
    
    %% Relationships - Payment and Shipping Domain
    payment_type ||--o{ user_payment_method : "type_of"
    payment_type ||--o{ shop_order : "paid_via"
    shipping_method ||--o{ shop_order : "shipped_via"
